var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.CONSTANTS=void 0;Object.defineProperty(exports,"emit",{enumerable:true,get:function get(){return _actions.emit;}});var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _reactNative=require("react-native");var _actions=require("./actions");var RNCallKeepModule=_reactNative.NativeModules.RNCallKeep;var isIOS=_reactNative.Platform.OS==='ios';var supportConnectionService=!isIOS&&_reactNative.Platform.Version>=23;var CONSTANTS={END_CALL_REASONS:{FAILED:1,REMOTE_ENDED:2,UNANSWERED:3,ANSWERED_ELSEWHERE:4,DECLINED_ELSEWHERE:isIOS?5:2,MISSED:isIOS?2:6}};exports.CONSTANTS=CONSTANTS;var RNCallKeep=function(){function RNCallKeep(){var _this=this;(0,_classCallCheck2.default)(this,RNCallKeep);this.addEventListener=function(type,handler){var listener=_actions.listeners[type](handler);_this._callkeepEventHandlers.set(type,listener);};this.removeEventListener=function(type){var listener=_this._callkeepEventHandlers.get(type);if(!listener){return;}listener.remove();_this._callkeepEventHandlers.delete(type);};this.setup=function(){var _ref=(0,_asyncToGenerator2.default)(function*(options){if(!isIOS){return _this._setupAndroid(options.android);}return _this._setupIOS(options.ios);});return function(_x){return _ref.apply(this,arguments);};}();this.setSettings=function(settings){return RNCallKeepModule.setSettings(settings[isIOS?'ios':'android']);};this.registerPhoneAccount=function(options){if(isIOS){return;}RNCallKeepModule.registerPhoneAccount(options.android);};this.registerAndroidEvents=function(){if(isIOS){return;}RNCallKeepModule.registerEvents();};this.unregisterAndroidEvents=function(){if(isIOS){return;}RNCallKeepModule.unregisterEvents();};this.hasDefaultPhoneAccount=function(){var _ref2=(0,_asyncToGenerator2.default)(function*(options){if(!isIOS){return _this._hasDefaultPhoneAccount(options);}return;});return function(_x2){return _ref2.apply(this,arguments);};}();this.displayIncomingCall=function(uuid,handle){var _options$ios$supports,_options$ios,_options$ios$supports2,_options$ios2,_options$ios$supports3,_options$ios3,_options$ios$supports4,_options$ios4;var localizedCallerName=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var handleType=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'number';var hasVideo=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var options=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;if(!isIOS){RNCallKeepModule.displayIncomingCall(uuid,handle,localizedCallerName,hasVideo);return;}var supportsHolding=!!((_options$ios$supports=options==null?void 0:(_options$ios=options.ios)==null?void 0:_options$ios.supportsHolding)!=null?_options$ios$supports:true);var supportsDTMF=!!((_options$ios$supports2=options==null?void 0:(_options$ios2=options.ios)==null?void 0:_options$ios2.supportsDTMF)!=null?_options$ios$supports2:true);var supportsGrouping=!!((_options$ios$supports3=options==null?void 0:(_options$ios3=options.ios)==null?void 0:_options$ios3.supportsGrouping)!=null?_options$ios$supports3:true);var supportsUngrouping=!!((_options$ios$supports4=options==null?void 0:(_options$ios4=options.ios)==null?void 0:_options$ios4.supportsUngrouping)!=null?_options$ios$supports4:true);RNCallKeepModule.displayIncomingCall(uuid,handle,handleType,hasVideo,localizedCallerName,supportsHolding,supportsDTMF,supportsGrouping,supportsUngrouping);};this.answerIncomingCall=function(uuid){RNCallKeepModule.answerIncomingCall(uuid);};this.startCall=function(uuid,handle,contactIdentifier){var handleType=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'number';var hasVideo=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;if(!isIOS){RNCallKeepModule.startCall(uuid,handle,contactIdentifier,hasVideo);return;}RNCallKeepModule.startCall(uuid,handle,contactIdentifier,handleType,hasVideo);};this.checkPhoneAccountEnabled=(0,_asyncToGenerator2.default)(function*(){if(isIOS){return;}return RNCallKeepModule.checkPhoneAccountEnabled();});this.isConnectionServiceAvailable=(0,_asyncToGenerator2.default)(function*(){if(isIOS){return true;}return RNCallKeepModule.isConnectionServiceAvailable();});this.reportConnectingOutgoingCallWithUUID=function(uuid){if(isIOS){RNCallKeepModule.reportConnectingOutgoingCallWithUUID(uuid);}};this.reportConnectedOutgoingCallWithUUID=function(uuid){if(isIOS){RNCallKeepModule.reportConnectedOutgoingCallWithUUID(uuid);}};this.reportEndCallWithUUID=function(uuid,reason){return RNCallKeepModule.reportEndCallWithUUID(uuid,reason);};this.rejectCall=function(uuid){if(!isIOS){RNCallKeepModule.rejectCall(uuid);}else{RNCallKeepModule.endCall(uuid);}};this.isCallActive=function(){var _ref5=(0,_asyncToGenerator2.default)(function*(uuid){return yield RNCallKeepModule.isCallActive(uuid);});return function(_x3){return _ref5.apply(this,arguments);};}();this.getCalls=function(){if(isIOS){return RNCallKeepModule.getCalls();}};this.endCall=function(uuid){return RNCallKeepModule.endCall(uuid);};this.endAllCalls=function(){return RNCallKeepModule.endAllCalls();};this.supportConnectionService=function(){return supportConnectionService;};this.hasPhoneAccount=(0,_asyncToGenerator2.default)(function*(){return isIOS?true:yield RNCallKeepModule.hasPhoneAccount();});this.hasOutgoingCall=(0,_asyncToGenerator2.default)(function*(){return isIOS?null:yield RNCallKeepModule.hasOutgoingCall();});this.setMutedCall=function(uuid,shouldMute){RNCallKeepModule.setMutedCall(uuid,shouldMute);};this.sendDTMF=function(uuid,key){return RNCallKeepModule.sendDTMF(uuid,key);};this.toggleAudioRouteSpeaker=function(uuid,routeSpeaker){return isIOS?null:RNCallKeepModule.toggleAudioRouteSpeaker(uuid,routeSpeaker);};this.getAudioRoutes=function(){return RNCallKeepModule.getAudioRoutes();};this.setAudioRoute=function(uuid,inputName){return RNCallKeepModule.setAudioRoute(uuid,inputName);};this.checkIfBusy=function(){return isIOS?RNCallKeepModule.checkIfBusy():Promise.reject('RNCallKeep.checkIfBusy was called from unsupported OS');};this.checkSpeaker=function(){return isIOS?RNCallKeepModule.checkSpeaker():Promise.reject('RNCallKeep.checkSpeaker was called from unsupported OS');};this.setAvailable=function(state){if(isIOS){return;}RNCallKeepModule.setAvailable(state);};this.setForegroundServiceSettings=function(settings){if(isIOS){return;}RNCallKeepModule.setForegroundServiceSettings(settings);};this.canMakeMultipleCalls=function(state){if(isIOS){return;}RNCallKeepModule.canMakeMultipleCalls(state);};this.setCurrentCallActive=function(callUUID){if(isIOS){return;}RNCallKeepModule.setCurrentCallActive(callUUID);};this.updateDisplay=function(uuid,displayName,handle){var options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(!isIOS){RNCallKeepModule.updateDisplay(uuid,displayName,handle);return;}var iosOptions={};if(options&&options.ios){iosOptions=Object.assign({},options.ios);}RNCallKeepModule.updateDisplay(uuid,displayName,handle,iosOptions);};this.setOnHold=function(uuid,shouldHold){return RNCallKeepModule.setOnHold(uuid,shouldHold);};this.setConnectionState=function(uuid,state){return isIOS?null:RNCallKeepModule.setConnectionState(uuid,state);};this.setReachable=function(){return RNCallKeepModule.setReachable();};this.reportUpdatedCall=function(uuid,localizedCallerName){console.warn('RNCallKeep.reportUpdatedCall is deprecated, use RNCallKeep.updateDisplay instead');return isIOS?RNCallKeepModule.reportUpdatedCall(uuid,localizedCallerName):Promise.reject('RNCallKeep.reportUpdatedCall was called from unsupported OS');};this._setupIOS=function(){var _ref8=(0,_asyncToGenerator2.default)(function*(options){return new Promise(function(resolve,reject){if(!options.appName){reject('RNCallKeep.setup: option "appName" is required');}if(typeof options.appName!=='string'){reject('RNCallKeep.setup: option "appName" should be of type "string"');}resolve(RNCallKeepModule.setup(options));});});return function(_x4){return _ref8.apply(this,arguments);};}();this._setupAndroid=function(){var _ref9=(0,_asyncToGenerator2.default)(function*(options){RNCallKeepModule.setup(options);if(options.selfManaged){return false;}var showAccountAlert=yield RNCallKeepModule.checkPhoneAccountPermission(options.additionalPermissions||[]);var shouldOpenAccounts=yield _this._alert(options,showAccountAlert);if(shouldOpenAccounts){RNCallKeepModule.openPhoneAccounts();return true;}return false;});return function(_x5){return _ref9.apply(this,arguments);};}();this._hasDefaultPhoneAccount=function(){var _ref10=(0,_asyncToGenerator2.default)(function*(options){var hasDefault=yield RNCallKeepModule.checkDefaultPhoneAccount();var shouldOpenAccounts=yield _this._alert(options,hasDefault);if(shouldOpenAccounts){RNCallKeepModule.openPhoneAccountSettings();}});return function(_x6){return _ref10.apply(this,arguments);};}();this._alert=function(){var _ref11=(0,_asyncToGenerator2.default)(function*(options,condition){return new Promise(function(resolve,reject){if(!condition){return resolve(false);}_reactNative.Alert.alert(options.alertTitle,options.alertDescription,[{text:options.cancelButton,onPress:reject,style:'cancel'},{text:options.okButton,onPress:function onPress(){return resolve(true);}}],{cancelable:true});});});return function(_x7,_x8){return _ref11.apply(this,arguments);};}();this._callkeepEventHandlers=new Map();}(0,_createClass2.default)(RNCallKeep,[{key:"backToForeground",value:function backToForeground(){if(isIOS){return;}_reactNative.NativeModules.RNCallKeep.backToForeground();}},{key:"getInitialEvents",value:function getInitialEvents(){return RNCallKeepModule.getInitialEvents();}},{key:"clearInitialEvents",value:function clearInitialEvents(){return RNCallKeepModule.clearInitialEvents();}}]);return RNCallKeep;}();var _default=new RNCallKeep();exports.default=_default;