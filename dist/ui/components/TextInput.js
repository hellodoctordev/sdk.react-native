var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=TextInput;exports.defaultTextInputBorderColor=void 0;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _lodash=_interopRequireDefault(require("lodash"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _HideableView=_interopRequireDefault(require("./HideableView"));var _CollapsibleView=_interopRequireDefault(require("./CollapsibleView"));var _theme=require("../theme");var _jsxFileName="/Users/hellodoctor/workspace/mobile/sdk/react-native/lib/ui/components/TextInput.tsx";function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}var defaultTextInputBorderColor=(0,_theme.alpha)(_theme.HelloDoctorColors.Gray500,0.3);exports.defaultTextInputBorderColor=defaultTextInputBorderColor;function TextInput(props){var _useState=(0,_react.useState)(props.value),_useState2=(0,_slicedToArray2.default)(_useState,2),value=_useState2[0],setValue=_useState2[1];var shadowRadiusRef=(0,_react.useRef)(new _reactNative.Animated.Value(0));var shadowHeightRef=(0,_react.useRef)(new _reactNative.Animated.Value(0));var shadowOpacityRef=(0,_react.useRef)(new _reactNative.Animated.Value(0));var labelOpacityRef=(0,_react.useRef)(new _reactNative.Animated.Value(1));var containerRef=(0,_react.useRef)();var layoutRef=(0,_react.useRef)({});var inputRef=(0,_react.useRef)();var isValid=props.minLength&&props.required?_lodash.default.size(value)>=props.minLength:props.minLength?_lodash.default.isEmpty(value)||_lodash.default.size(value)>=props.minLength:props.required?!_lodash.default.isEmpty(value):true;(0,_react.useEffect)(function(){setValue(props.value);},[props.value]);var doFocusAnimation=function doFocusAnimation(){return _reactNative.Animated.parallel([_reactNative.Animated.timing(shadowRadiusRef.current,{toValue:2,duration:400,useNativeDriver:true}),_reactNative.Animated.timing(shadowHeightRef.current,{toValue:2,duration:400,useNativeDriver:true}),_reactNative.Animated.timing(shadowOpacityRef.current,{toValue:0.3,duration:400,useNativeDriver:true}),_reactNative.Animated.timing(labelOpacityRef.current,{toValue:0.5,duration:600,useNativeDriver:true})]).start();};var doBlurAnimation=function doBlurAnimation(){return _reactNative.Animated.parallel([_reactNative.Animated.timing(shadowRadiusRef.current,{toValue:0,duration:300,useNativeDriver:true}),_reactNative.Animated.timing(shadowHeightRef.current,{toValue:0,duration:300,useNativeDriver:true}),_reactNative.Animated.timing(shadowOpacityRef.current,{toValue:0,duration:400,useNativeDriver:true}),_reactNative.Animated.timing(labelOpacityRef.current,{toValue:1,duration:300,useNativeDriver:true})]).start();};function handleOnChangeText(){setValue(value);props.onChangeText(value);}var handleOnFocus=function handleOnFocus(event){doFocusAnimation();if(props.onFocus){props.onFocus(event);}if(!_lodash.default.isEmpty(props.scrollRef)){var scrollableNode=props.scrollRef.getScrollableNode();if(containerRef.current!==undefined&&!containerRef.current.measureLayout){console.warn(props.label+" is fucked up",_lodash.default.keys(containerRef.current));}var doScroll=function doScroll(){var _containerRef$current;return(_containerRef$current=containerRef.current)==null?void 0:_containerRef$current.measureLayout(scrollableNode,function(left,top,_width,_height){var scrollMarginTop=props.scrollMarginTop||128;var scrollToY=top-scrollMarginTop;console.debug('scrollToY',scrollToY);props.scrollRef.scrollTo({y:scrollToY});},function(){console.warn('[TextInput:handleOnFocus:doScroll:FAILED]');});};var tryScroll=function tryScroll(){var _containerRef$current2;return((_containerRef$current2=containerRef.current)==null?void 0:_containerRef$current2.measureLayout)&&doScroll();};setTimeout(tryScroll,300);}};function handleOnBlur(event){if(!props.hasError&&isValid){doBlurAnimation();}if(props.onBlur){props.onBlur(event);}}var setInputRef=function setInputRef(ref){inputRef.current=props.editable!==false?ref:{focus:handleOnFocus,blur:handleOnBlur};if(props.forwardRef){props.forwardRef(inputRef.current);}};var handleOnPress=function handleOnPress(){if(props.disabled){return;}inputRef.current.focus();if(props.onPress){props.onPress();}};var renderedValue=props.value?""+props.value:'';var requiredLabel=props.required&&!isValid?'Obligatorio':null;var validityColor=_lodash.default.isEmpty(value)?defaultTextInputBorderColor:isValid&&!props.hasError?_theme.HelloDoctorColors.Green500:_theme.HelloDoctorColors.Red300;return props.isHidden?null:_react.default.createElement(_reactNative.TouchableOpacity,{onPress:handleOnPress,ref:function ref(_ref3){containerRef.current=_ref3;},onLayout:function onLayout(_ref2){var nativeEvent=_ref2.nativeEvent;layoutRef.current=nativeEvent.layout;},style:Object.assign({padding:3,paddingLeft:6,paddingRight:6,minHeight:props.display==='none'?0:props.multiline?128:0,overflow:props.display==='none'?'hidden':undefined,borderWidth:1,borderRadius:4,backgroundColor:'white',borderColor:validityColor},props.containerStyle),__self:this,__source:{fileName:_jsxFileName,lineNumber:217,columnNumber:9}},_react.default.createElement(_HideableView.default,{isHidden:!props.label,style:{flexDirection:'row',alignItems:'center'},__self:this,__source:{fileName:_jsxFileName,lineNumber:240,columnNumber:13}},_react.default.createElement(_reactNative.Animated.Text,{style:Object.assign({flex:1,opacity:labelOpacityRef.current,fontSize:13,fontFamily:_theme.HelloDoctorFonts.TextRegular,color:_theme.HelloDoctorColors.Gray500},props.labelStyle),__self:this,__source:{fileName:_jsxFileName,lineNumber:243,columnNumber:17}},props.label),_react.default.createElement(_reactNative.Text,{style:{fontFamily:_theme.HelloDoctorFonts.TextBold,fontSize:13,color:_theme.HelloDoctorColors.Red300},__self:this,__source:{fileName:_jsxFileName,lineNumber:256,columnNumber:17}},requiredLabel)),_react.default.createElement(_reactNative.View,{style:{flexDirection:'row',alignItems:'center'},__self:this,__source:{fileName:_jsxFileName,lineNumber:265,columnNumber:13}},_react.default.createElement(_reactNative.TextInput,{testID:props.testID,ref:setInputRef,autoFocus:props.autoFocus,placeholder:props.placeholder,placeholderTextColor:props.placeholderTextColor,value:renderedValue,onChangeText:handleOnChangeText,onFocus:handleOnFocus,onBlur:handleOnBlur,editable:props.editable,textContentType:props.textContentType,keyboardType:props.keyboardType,returnKeyType:props.returnKeyType,selectionColor:props.selectionColor||_theme.HelloDoctorColors.Blue500,maxLength:props.maxLength,multiline:props.multiline,blurOnSubmit:props.blurOnSubmit,numberOfLines:props.numberOfLines,autoComplete:props.autoComplete,autoCapitalize:props.autoCapitalize,secureTextEntry:props.secureTextEntry,onSubmitEditing:props.onSubmitEditing,clearButtonMode:props.clearButtonMode,importantForAutofill:props.importantForAutofill,style:Object.assign({maxHeight:props.display==='none'?0:undefined,overflow:'hidden',flex:props.editable===false?0:1,fontFamily:_theme.HelloDoctorFonts.TextRegular,fontSize:17,color:_theme.HelloDoctorColors.Blue700},props.style),__self:this,__source:{fileName:_jsxFileName,lineNumber:266,columnNumber:17}}),_react.default.createElement(_HideableView.default,{isHidden:!props.required||props.icon||props.display==='none',__self:this,__source:{fileName:_jsxFileName,lineNumber:308,columnNumber:17}},_react.default.createElement(_CollapsibleView.default,{isCollapsed:!isValid||props.hasError,horizontal:true,__self:this,__source:{fileName:_jsxFileName,lineNumber:314,columnNumber:21}}))));}