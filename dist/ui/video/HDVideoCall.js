var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=HDVideoCall;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _HDVideoCallView=_interopRequireDefault(require("./HDVideoCallView"));var _native=require("./native");var _connectionManager=require("../../telecom/connectionManager");var _eventHandlers=require("../../telecom/eventHandlers");var _video=_interopRequireDefault(require("../../api/video"));var _jsxFileName="/Users/hellodoctor/workspace/mobile/sdk/react-native/lib/ui/video/HDVideoCall.js";function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function HDVideoCall(props){var _useState=(0,_react.useState)(props.videoRoomSID),_useState2=(0,_slicedToArray2.default)(_useState,2),videoRoomSID=_useState2[0],setVideoRoomSID=_useState2[1];var _useState3=(0,_react.useState)(props.consultationID),_useState4=(0,_slicedToArray2.default)(_useState3,2),consultationID=_useState4[0],setConsultationID=_useState4[1];var _useState5=(0,_react.useState)(props.accessToken),_useState6=(0,_slicedToArray2.default)(_useState5,2),accessToken=_useState6[0],setAccessToken=_useState6[1];(0,_react.useEffect)(function(){doBootstrapCall();},[]);(0,_react.useEffect)(function(){if(videoRoomSID&&!accessToken){doRequestAccessToken();}},[videoRoomSID]);function doBootstrapCall(){if(!videoRoomSID){var incomingCall=(0,_connectionManager.getIncomingCall)();if(!incomingCall){console.warn('[HDVideoCall:doBootstrapCall] no incoming call found');(0,_eventHandlers.navigateOnEndCall)();return;}setVideoRoomSID(incomingCall.videoRoomSID);setConsultationID(incomingCall.consultationID);}}function doRequestAccessToken(){_video.default.requestVideoCallAccess(videoRoomSID).then(function(_ref){var accessToken=_ref.accessToken;return setAccessToken(accessToken);}).catch(function(error){console.warn('[HDVideoCall:doRequestAccessToken] aborting call due to error:',error);(0,_eventHandlers.navigateOnEndCall)();});}return _react.default.createElement(_react.default.Fragment,{__self:this,__source:{fileName:_jsxFileName,lineNumber:55,columnNumber:9}},!accessToken&&_react.default.createElement(_native.LocalVideoView,{style:{width:'100%',height:'100%'},__self:this,__source:{fileName:_jsxFileName,lineNumber:57,columnNumber:17}}),accessToken&&_react.default.createElement(_HDVideoCallView.default,{videoRoomSID:videoRoomSID,consultationID:consultationID,accessToken:accessToken,__self:this,__source:{fileName:_jsxFileName,lineNumber:60,columnNumber:17}}));}